const filteredCollection = [

    {
        "plant_name": "3GorgesWFrm",
        "power_plant_code": 15014,
        "fca_code": "705",
        "sddp_code": "75.0000",
        "company": "Three Gorges First Wind Farm Pakistan (Private) Limited",
        "address": "House No.5, Street No.72, F-8/3, Islamabad, Pakistan",
        "longitude": "69.466",
        "latitude": "35.48",
        "project_nature": "Private",
        "policy_reference": "2006",
        "agreement_type": "EPA",
        "contract_type": "Take and Pay",
        "units": "1.0000",
        "technical_parameter_id": 67,
        "disco_id": 2,
        "economic_parameters_id": 67,
        "dollar_parity": "101.5000",
        "us_cpi": "238.0300",
        "local_cpi": "199.4000",
        "cod": "2013-11-01",
        "term": 20,
        "end_year": 2033,
        "kibor": "0.0000",
        "libor": "0.0033",
        "sinsoure_fee": "0.0000",
        "rmb_rate": "0.0200",
        "paramCombineID": 189292,
        "commercial_parameter_name": "fom_foreign",
        "years": 6,
        "rate": "0.8660"
    },
    {
        "plant_name": "3GorgesWFrm",
        "power_plant_code": 15014,
        "fca_code": "705",
        "sddp_code": "75.0000",
        "company": "Three Gorges First Wind Farm Pakistan (Private) Limited",
        "address": "House No.5, Street No.72, F-8/3, Islamabad, Pakistan",
        "longitude": "69.466",
        "latitude": "35.48",
        "project_nature": "Private",
        "policy_reference": "2006",
        "agreement_type": "EPA",
        "contract_type": "Take and Pay",
        "units": "1.0000",
        "technical_parameter_id": 67,
        "disco_id": 2,
        "economic_parameters_id": 67,
        "dollar_parity": "101.5000",
        "us_cpi": "238.0300",
        "local_cpi": "199.4000",
        "cod": "2013-11-01",
        "term": 20,
        "end_year": 2033,
        "kibor": "0.0000",
        "libor": "0.0033",
        "sinsoure_fee": "0.0000",
        "rmb_rate": "0.0200",
        "paramCombineID": 189814,
        "commercial_parameter_name": "fom_foreign",
        "years": 8,
        "rate": "0.8660"
    },
    {
        "plant_name": "3GorgesWFrm2",
        "power_plant_code": 15027,
        "fca_code": "743",
        "sddp_code": "174.0000",
        "company": "2nd Windfarm",
        "address": "Serena Business Complex Level CASIL Office, Kyaban e Sohurwardy",
        "longitude": "69.466",
        "latitude": "35.48",
        "project_nature": "CPEC",
        "policy_reference": "RE 2006",
        "agreement_type": "EPA",
        "contract_type": "Take and Pay",
        "units": "1.0000",
        "technical_parameter_id": 158,
        "disco_id": 2,
        "economic_parameters_id": 158,
        "dollar_parity": "101.5000",
        "us_cpi": "233.7070",
        "local_cpi": "1.0000",
        "cod": "2017-06-01",
        "term": 20,
        "end_year": 2037,
        "kibor": "0.0000",
        "libor": "0.0027",
        "sinsoure_fee": "0.0000",
        "rmb_rate": "0.0200",
        "paramCombineID": 209219,
        "commercial_parameter_name": "fom_local",
        "years": 2,
        "rate": "0.0000"
    },
    {
        "plant_name": "3GorgesWFrm2",
        "power_plant_code": 15027,
        "fca_code": "743",
        "sddp_code": "174.0000",
        "company": "2nd Windfarm",
        "address": "Serena Business Complex Level CASIL Office, Kyaban e Sohurwardy",
        "longitude": "69.466",
        "latitude": "35.48",
        "project_nature": "CPEC",
        "policy_reference": "RE 2006",
        "agreement_type": "EPA",
        "contract_type": "Take and Pay",
        "units": "1.0000",
        "technical_parameter_id": 158,
        "disco_id": 2,
        "economic_parameters_id": 158,
        "dollar_parity": "101.5000",
        "us_cpi": "233.7070",
        "local_cpi": "1.0000",
        "cod": "2017-06-01",
        "term": 20,
        "end_year": 2037,
        "kibor": "0.0000",
        "libor": "0.0027",
        "sinsoure_fee": "0.0000",
        "rmb_rate": "0.0200",
        "paramCombineID": 209741,
        "commercial_parameter_name": "fom_local",
        "years": 4,
        "rate": "0.0000"
    },
    {
        "plant_name": "3GorgesWFrm",
        "power_plant_code": 15014,
        "fca_code": "705",
        "sddp_code": "75.0000",
        "company": "Three Gorges First Wind Farm Pakistan (Private) Limited",
        "address": "House No.5, Street No.72, F-8/3, Islamabad, Pakistan",
        "longitude": "69.466",
        "latitude": "35.48",
        "project_nature": "Private",
        "policy_reference": "2006",
        "agreement_type": "EPA",
        "contract_type": "Take and Pay",
        "units": "1.0000",
        "technical_parameter_id": 67,
        "disco_id": 2,
        "economic_parameters_id": 67,
        "dollar_parity": "101.5000",
        "us_cpi": "238.0300",
        "local_cpi": "199.4000",
        "cod": "2013-11-01",
        "term": 20,
        "end_year": 2033,
        "kibor": "0.0000",
        "libor": "0.0033",
        "sinsoure_fee": "0.0000",
        "rmb_rate": "0.0200",
        "paramCombineID": 210172,
        "commercial_parameter_name": "fom_local",
        "years": 6,
        "rate": "0.7673"
    },
    {
        "plant_name": "3GorgesWFrm",
        "power_plant_code": 15014,
        "fca_code": "705",
        "sddp_code": "75.0000",
        "company": "Three Gorges First Wind Farm Pakistan (Private) Limited",
        "address": "House No.5, Street No.72, F-8/3, Islamabad, Pakistan",
        "longitude": "69.466",
        "latitude": "35.48",
        "project_nature": "Private",
        "policy_reference": "2006",
        "agreement_type": "EPA",
        "contract_type": "Take and Pay",
        "units": "1.0000",
        "technical_parameter_id": 67,
        "disco_id": 2,
        "economic_parameters_id": 67,
        "dollar_parity": "101.5000",
        "us_cpi": "238.0300",
        "local_cpi": "199.4000",
        "cod": "2013-11-01",
        "term": 20,
        "end_year": 2033,
        "kibor": "0.0000",
        "libor": "0.0033",
        "sinsoure_fee": "0.0000",
        "rmb_rate": "0.0200",
        "paramCombineID": 210694,
        "commercial_parameter_name": "fom_local",
        "years": 8,
        "rate": "0.7673"
    },
    {
        "plant_name": "3GorgesWFrm2",
        "power_plant_code": 15027,
        "fca_code": "743",
        "sddp_code": "174.0000",
        "company": "2nd Windfarm",
        "address": "Serena Business Complex Level CASIL Office, Kyaban e Sohurwardy",
        "longitude": "69.466",
        "latitude": "35.48",
        "project_nature": "CPEC",
        "policy_reference": "RE 2006",
        "agreement_type": "EPA",
        "contract_type": "Take and Pay",
        "units": "1.0000",
        "technical_parameter_id": 158,
        "disco_id": 2,
        "economic_parameters_id": 158,
        "dollar_parity": "101.5000",
        "us_cpi": "233.7070",
        "local_cpi": "1.0000",
        "cod": "2017-06-01",
        "term": 20,
        "end_year": 2037,
        "kibor": "0.0000",
        "libor": "0.0027",
        "sinsoure_fee": "0.0000",
        "rmb_rate": "0.0200",
        "paramCombineID": 230099,
        "commercial_parameter_name": "insurance",
        "years": 2,
        "rate": "0.6349"
    },
    {
        "plant_name": "3GorgesWFrm2",
        "power_plant_code": 15027,
        "fca_code": "743",
        "sddp_code": "174.0000",
        "company": "2nd Windfarm",
        "address": "Serena Business Complex Level CASIL Office, Kyaban e Sohurwardy",
        "longitude": "69.466",
        "latitude": "35.48",
        "project_nature": "CPEC",
        "policy_reference": "RE 2006",
        "agreement_type": "EPA",
        "contract_type": "Take and Pay",
        "units": "1.0000",
        "technical_parameter_id": 158,
        "disco_id": 2,
        "economic_parameters_id": 158,
        "dollar_parity": "101.5000",
        "us_cpi": "233.7070",
        "local_cpi": "1.0000",
        "cod": "2017-06-01",
        "term": 20,
        "end_year": 2037,
        "kibor": "0.0000",
        "libor": "0.0027",
        "sinsoure_fee": "0.0000",
        "rmb_rate": "0.0200",
        "paramCombineID": 230621,
        "commercial_parameter_name": "insurance",
        "years": 4,
        "rate": "0.6349"
    }


]
const restructureOutput = (filteredCollection) => {
    var restructuredOutput = []
    var nameArray = false

    filteredCollection.forEach(collection => {
        var internalArray = false
        var externalAray = false

        console.log("Collection Selected :", collection.plant_name, collection.years)

        restructuredOutput.forEach(arr => {

            console.log("INSIDE restructuredOutput ---------------------------> arr selected: :", arr.length)
            console.log('nameArray in :       ', nameArray)
            console.log('externalArray:       ', externalAray)
            console.log('internArray:       ', internalArray)

            arr.forEach(plant => {
                console.log("INSIDE arr ---------------------------> plant selected: :", plant.plant_name, plant.years)
                console.log('nameArray in :       ', nameArray)
                console.log('externalArray:       ', externalAray)
                console.log('internArray:       ', internalArray)
                console.log('plant.plant_name === collection.plant_name :', plant.plant_name === collection.plant_name)
                console.log('plant.years === collection.years:', plant.years === collection.years)
                if (plant.plant_name === collection.plant_name) {
                    console.log("plantName  exist in : ", collection.plant_name, collection.years)

                    nameArray = true

                    if (plant.years === collection.years) {
                        console.log("plantName and year exist in : ", collection.plant_name, collection.years)

                        plant.commercialparameters.push({ "commercial_parameter_name": collection.commercial_parameter_name, 'rate': collection.rate })

                    } else {
                        console.log("plantName exist in arr but not year: ", collection.plant_name, collection.years)

                        internalArray = true
                    }
                } else if (!externalAray && !internalArray) {
                    console.log("plant doesnot exist in arr: ", collection.plant_name, collection.years)
                    nameArray = false
                }
                console.log("END arr ---------------------------> plant selected: :", plant.plant_name, plant.years)
                console.log('nameArray in :       ', nameArray)
                console.log('externalArray:       ', externalAray)
                console.log('internArray:       ', internalArray)

            })
            if (internalArray) {

                const powerplant = { ...collection }

                delete powerplant.commercial_parameter_name
                delete powerplant.paramCombineID
                delete powerplant.rate

                powerplant.commercialparameters = [{ "commercial_parameter_name": collection.commercial_parameter_name, 'rate': collection.rate }]
                console.log("ADDING IN ARR")
                arr.push(powerplant)


            }
            console.log("END restr ---------------------------> plant selected: :", arr.length)
            console.log('nameArray in :       ', nameArray)
            console.log('externalArray:       ', externalAray)
            console.log('internArray:       ', internalArray)

        })
        if (!nameArray) {
            const powerplant = { ...collection }

            delete powerplant.commercial_parameter_name
            delete powerplant.paramCombineID
            delete powerplant.rate

            powerplant.commercialparameters = [{ "commercial_parameter_name": collection.commercial_parameter_name, 'rate': collection.rate }]

            restructuredOutput.push([powerplant])
            nameArray = true
            externalAray = true


        }
        console.log("END filtered ---------------------------> plant selected: :")
        console.log('nameArray in :       ', nameArray)
        console.log('externalArray:       ', externalAray)
        console.log('internArray:       ', internalArray)

    })
    console.log("restructuredOutput ", restructuredOutput)
    return restructuredOutput
}
restructureOutput(filteredCollection)
